<style> 
  .component-page-toolbar__btn_edit{ display: none; } 

  .material-design-theme .page__header-body {
    padding: 0;
  }
  
  .material-design-theme .page__header {
    margin-bottom: 0;
  }
</style>
<ol class="page-breadcrumb">
  <li>
    <mp-link title="Home" url="/">Home</mp-link>
  </li>
  <li class="active">
    <mp-label iri='[[this]]'></mp-label>
  </li>
</ol>

<div class="page material-design-theme">

  <div class='page__header'>
    [[#if (ask "ASK{?? vcard:hasGender vcard:male}")]]
    	[[> Platform:DefaultResourceHeader noImage="/images/icons/thenounproject/np_businessman_1384874_000000.png"]]
    [[else]]
    	[[> Platform:DefaultResourceHeader noImage="/images/icons/thenounproject/np_woman_969550_000000.png"]]
    [[/if]]
  </div>
  <div class='page__body'>
    [[#if (ask "ASK {?? person:holdsPosition|person:hasTenureInOrganization|person:hasQualification|common:hasPublicationStatus ?x}")]]
		<bs-row>
      <bs-col md=6>
        <h2>Positions &amp; Education</h2>
        <semantic-graph query='
          CONSTRUCT {
            ?person vcard:hasGender ?gender .
            ?organization a organization:Organization .
            ?tenureHolder a person:Officership ;
                person:isTenureIn ?organization ;
                person:hasHolder ?person . 

            ?person vcard:hasGender ?gender ;
                    person:hasQualification ?qualification .

            ?qualification a person:AcademicQualification ;
                person:withDegree ?degree ;
                person:fromInstitutionName ?institution ;
                person:inSubject ?subject .
            ?degree a person:AcademicDegree .
            ?subject a person:Major .

            ?organization2 a organization:Organization .
            ?positionHolder a person:Officership ;
                            person:isPositionIn ?organization2 ;
                            person:hasHolder ?person ;
                            person:hasPositionType ?positionType .

            ?positionType rdf:type person:OfficerRole .
          } WHERE {
            ?person vcard:hasGender ?gender .
            OPTIONAL {
              ?tenureHolder person:isTenureIn ?organization ;
                person:hasHolder ?person ;
                common:hasPublicationStatus common:publicationstatuspublished .
              ?organization vcard:organization-name ?organizationName .
            }
            OPTIONAL {
              ?positionHolder person:isPositionIn ?organization2 ;
                              person:hasHolder ?person ;
                              common:hasPublicationStatus common:publicationstatuspublished .
              OPTIONAL {
                ?positionHolder person:hasPositionType ?positionType .
              }
              ?organization2 vcard:organization-name ?2organizationName .
            }

            OPTIONAL {
              ?person person:hasQualification ?qualification .
              ?qualification common:hasPublicationStatus common:publicationstatuspublished .
              OPTIONAL {
                ?qualification person:withDegree ?degree .
              }

              OPTIONAL {
                ?qualification person:fromInstitutionName ?institution .
              }

              OPTIONAL {
                ?qualification person:inSubject ?subject .
              }
            }

            VALUES(?person) {
                (??)
            }
          }
              '
           hide-predicates='["<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>"]'
            graph-style='[
              [[> permid:GraphStyle]]
            ]'
        >  
          <semantic-graph-extension-navigator style="height: 150px; width: 150px;"></semantic-graph-extension-navigator>
          <semantic-graph-extension-panzoom pan-indicator-min-opacity="0.1"></semantic-graph-extension-panzoom>
        </semantic-graph>        
      </bs-col>
      <bs-col md=6>
        <h2>Positions</h2>
        <semantic-table
          query='
            SELECT DISTINCT (YEAR(?from) as ?start) (YEAR(?to) as ?end) ?title ?company WHERE { 
              ?positionHolder person:isPositionIn ?company ; 
                              common:hasPublicationStatus common:publicationstatuspublished ;
                              person:hasHolder ?? . 

              ?company vcard:organization-name ?organizationName .
              OPTIONAL { ?positionHolder person:hasReportedTitle ?title }
              OPTIONAL { ?positionHolder common:from ?from } 
              OPTIONAL { ?positionHolder common:to ?to } 
            } ORDER BY DESC(?from) DESC(?to)
          '
           column-configuration='[
             {"variableName": "company", "displayName": "Organization"},
             {"variableName": "title", "displayName": "Title"},
             {"variableName": "start", "displayName": "Start"},
             {"variableName": "end", "displayName": "End"}
           ]' 
           options='{"showFilter": false}'
           no-result-template='<div class="well text-center">No results in the dataset for this person</div>'
        >
        </semantic-table>
        <h2>Tenures in Organizations</h2>
        <semantic-table 
          query='
            SELECT DISTINCT (YEAR(?from) as ?Start) (YEAR(?to) as ?End) ?Organization WHERE { 
              ?tenureHolder person:isTenureIn ?Organization ;
                            common:hasPublicationStatus common:publicationstatuspublished ;
                            person:hasHolder ?? .
              OPTIONAL { ?tenureHolder common:from ?from } 
              OPTIONAL { ?tenureHolder common:to ?to } 
            } ORDER BY DESC(?from) DESC(?to)
          '
          options='{"showFilter": false}'
          no-result-template='<div class="well text-center">No results in the dataset for this person</div>'
        >
        </semantic-table>
        <h2>Education</h2>
        <semantic-table 
          query='
            SELECT DISTINCT ?Institution ?Degree ?Major WHERE { 
              ?? person:hasQualification ?qualification . 
              ?qualification common:hasPublicationStatus common:publicationstatuspublished .
              OPTIONAL {
                ?qualification person:withDegree ?Degree . 
              }
              OPTIONAL { ?qualification person:fromInstitutionName ?Institution . }
              OPTIONAL { ?qualification person:inSubject ?Major . }
            }
          ' 
          options='{"showFilter": false}'
          no-result-template='<div class="well text-center">No results in the dataset for this person</div>'
        >
        </semantic-table>
        
        [[#if (ask "ASK {?? ^<http://permid.org/ontology/person/hasHolder> ?x . ?x <http://permid.org/ontology/person/isPositionIn> ?company .  ?x2 <http://permid.org/ontology/person/isPositionIn> ?company . ?x2 <http://permid.org/ontology/person/hasHolder> ?collaborator . FILTER (?? != ?collaborator)}")]]
        <!--<h2>Position Holders in the Same Organizations</h2>
        <semantic-graph user-zooming-enabled=true query='CONSTRUCT {
  							?? a <http://permid.org/ontology/person/Person>.
                ?? <http://permid.org/ontology/person/isPositionIn> ?company.
  							?collaborator <http://permid.org/ontology/person/isPositionIn> ?company.
  							
  							?company a <http://permid.org/ontology/organization/Organization>.
  							?collaborator a <http://permid.org/ontology/person/Person>.
              }WHERE {
                ?s <http://permid.org/ontology/person/isPositionIn> ?company . 
                           ?company <http://www.w3.org/2006/vcard/ns#organization-name> ?organizationName .
                           ?s <http://permid.org/ontology/person/hasHolder> ?? . 
                           ?s2 <http://permid.org/ontology/person/hasHolder> ?collaborator .
  												 ?s2 <http://permid.org/ontology/person/isPositionIn> ?company . 
                           ?s <http://permid.org/ontology/common/from> ?from .
                           FILTER (?? != ?collaborator)
  												 FILTER NOT EXISTS { ?s <http://permid.org/ontology/common/to> ?to } 
                           ?s2 <http://permid.org/ontology/common/from> ?from2 .
  												 FILTER NOT EXISTS { ?s2 <http://permid.org/ontology/common/to> ?to2 }
              }'
           hide-predicates='["<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>"]'
            graph-style='[
              [[> permid:GraphStyle]],
              {
                "selector": "node[resource = iri(<[[this]]>)]",
                "style": {          
                  "background-image": "/images/icons/thenounproject/np_woman_969550_000000.png",
                  "background-fit": "contain",
                  "height": "50",
                  "width": "50",
                  "background-position": "center",
                  "border-color": "#0087A1",
                  "border-width": 4
                 }
              }
            ]'>  

          <semantic-graph-extension-navigator style="height: 150px; width: 150px;"></semantic-graph-extension-navigator>
          <semantic-graph-extension-panzoom pan-indicator-min-opacity="0.1"></semantic-graph-extension-panzoom>
        </semantic-graph>-->
        [[/if]]
      </bs-col>
    </bs-row>
    [[else]]
      <bs-row>
        <bs-col md=6 md-offset=3>
      [[> "http://www.metaphacts.com/ontologies/platform#SourceGraph"]]
        </bs-col>
      </bs-row>
    [[/if]]
	
  </div>
</div>


